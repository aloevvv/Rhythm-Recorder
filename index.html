<script>
  let audio = new Audio();
  let startTime = null;
  let activeKeys = {};
  let logList = document.getElementById("log");

  document.getElementById("startBtn").addEventListener("click", function() {
    if (!audio.src) {
      alert("Please select an audio file first.");
      return;
    }
    logList.innerHTML = "";
    startTime = performance.now();
    audio.play();
  });

  document.addEventListener("keydown", function(e) {
    if (startTime === null || activeKeys[e.key]) return;
    activeKeys[e.key] = performance.now();
  });

  document.addEventListener("keyup", function(e) {
    if (startTime === null || !activeKeys[e.key]) return;
    const pressTime = ((activeKeys[e.key] - startTime) / 1000).toFixed(3);
    const releaseTime = ((performance.now() - startTime) / 1000).toFixed(3);
    const duration = (releaseTime - pressTime).toFixed(3);

    const entry = document.createElement("li");
    entry.textContent = `"${e.key}" press ${pressTime}s, held ${duration}s`;
    logList.appendChild(entry);

    delete activeKeys[e.key];
  });
</script>
